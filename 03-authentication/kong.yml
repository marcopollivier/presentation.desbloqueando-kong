_format_version: "3.0"
_transform: true

# Consumer para JWT
consumers:
  - username: jwt-user
    custom_id: user-jwt
    jwt_secrets:
      - key: jwt-issuer-key
        secret: my-jwt-secret-key-with-256-bits-minimum-length-required-by-kong
        algorithm: HS256
  
# Service apontando para JSONPlaceholder  
services:
  - name: go-mock-api
    url: http://go-mock-api-1:3001
    connect_timeout: 60000
    write_timeout: 60000
    read_timeout: 60000
    retries: 5

# Route protegido com JWT - usando path simples
routes:
  - name: jwt-posts
    service: go-mock-api
    protocols:
      - http
      - https
    methods:
      - GET
    paths:
      - /posts
    strip_path: false
    preserve_host: false
    
  - name: jwt-users
    service: go-mock-api
    protocols:
      - http
      - https
    methods:
      - GET
    paths:
      - /users
    strip_path: false
    preserve_host: false

# Plugin JWT aplicado globalmente no service
plugins:
  - name: jwt
    service: go-mock-api
    config:
      key_claim_name: iss
      secret_is_base64: false
