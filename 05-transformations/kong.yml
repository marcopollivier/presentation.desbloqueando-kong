_format_version: "3.0"
_transform: true

services:
  - name: go-mock-api
    url: http://go-mock-api-1:3001

routes:
  - name: transform-route
    service: go-mock-api
    protocols: [http, https]
    methods: [GET, POST, PUT, PATCH, DELETE]
    paths: [/api]
    strip_path: true

plugins:
  # Correlation ID Plugin - gera ID único para request/response
  - name: correlation-id
    route: transform-route
    config:
      header_name: "X-Correlation-ID"
      generator: "uuid"
      echo_downstream: true
      
  # Request Transformer - adiciona headers extras
  - name: request-transformer
    route: transform-route
    config:
      add:
        headers:
          - "X-Gateway:Kong"
          
  # Response Transformer - limpa headers sensíveis e marca processamento
  - name: response-transformer
    route: transform-route  
    config:
      add:
        headers:
          - "X-Processed-By:Marco-Ollivier"
      remove:
        headers:
          - "X-Powered-By"
          - "Server"
          
  # File Log - registra requests com correlation ID
  - name: file-log
    route: transform-route
    config:
      path: "/tmp/kong-requests.log"
      reopen: true
