#!/bin/bash

echo "âš ï¸  AVISO SOBRE SINCRONIZAÃ‡ÃƒO DE TEMPO"
echo "======================================"
echo ""
echo "ðŸ” STATUS ATUAL:"
echo "   â€¢ MÃ©tricas Kong: âœ… FUNCIONANDO"
echo "   â€¢ Prometheus queries: âœ… FUNCIONANDO" 
echo "   â€¢ Grafana dashboards: âœ… FUNCIONANDO"
echo "   â€¢ SincronizaÃ§Ã£o de tempo: âš ï¸ WARNING (mas nÃ£o crÃ­tico)"
echo ""
echo "ðŸ’¡ EXPLICAÃ‡ÃƒO:"
echo "   O warning 'Server time is out of sync' no Prometheus Ã© um problema"
echo "   comum do Podman no macOS. Isso acontece porque:"
echo "   â€¢ Containers usam tempo interno diferente do host"
echo "   â€¢ macOS nÃ£o compartilha timezone automaticamente"
echo "   â€¢ Podman tem limitaÃ§Ãµes de sincronizaÃ§Ã£o temporal"
echo ""
echo "âœ… IMPORTANTE:"
echo "   â€¢ As mÃ©tricas continuam funcionando PERFEITAMENTE"
echo "   â€¢ Queries temporais (increase, rate) estÃ£o OK"
echo "   â€¢ Dashboards mostram dados corretos"
echo "   â€¢ Ã‰ apenas um aviso cosmÃ©tico"
echo ""
echo "ðŸŽ¯ PARA APRESENTAÃ‡ÃƒO:"
echo "   1. Ignore o warning amarelo no Prometheus"
echo "   2. Foque nos dashboards do Grafana"
echo "   3. As mÃ©tricas sÃ£o precisas e funcionais"
echo "   4. Explique que Ã© uma limitaÃ§Ã£o do ambiente de dev"
echo ""
echo "ðŸ”§ SOLUÃ‡ÃƒO EM PRODUÃ‡ÃƒO:"
echo "   â€¢ Use Docker ao invÃ©s de Podman"
echo "   â€¢ Configure NTP nos containers"
echo "   â€¢ Use Kubernetes para melhor gerenciamento"
echo "   â€¢ Configure timezone compartilhado"
echo ""
echo "ðŸ“Š TESTE AGORA:"
echo "   â€¢ Grafana: http://localhost:3000 (admin/admin123)"
echo "   â€¢ Prometheus: http://localhost:9090 (ignore warning)"
echo "   â€¢ Gere trÃ¡fego: ./simple-load-test.sh"
echo ""

# Gerar trÃ¡fego para mostrar que funciona
echo "ðŸš€ Gerando trÃ¡fego de teste..."
./simple-load-test.sh > /dev/null 2>&1

echo ""
echo "ðŸ“ˆ MÃ‰TRICAS ATUAIS:"
TOTAL=$(curl -s "http://localhost:9090/api/v1/query?query=sum(kong_http_requests_total)" | jq -r '.data.result[0].value[1]' 2>/dev/null)
RATE=$(curl -s "http://localhost:9090/api/v1/query?query=sum(rate(kong_http_requests_total%5B5m%5D))" | jq -r '.data.result[0].value[1]' 2>/dev/null)
echo "   â€¢ Total requests: $TOTAL"
echo "   â€¢ Current rate: $RATE req/s"
echo ""
echo "âœ… TUDO FUNCIONANDO! Warning Ã© apenas cosmÃ©tico."
